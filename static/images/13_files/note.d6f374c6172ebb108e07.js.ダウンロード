(window.webpackJsonp=window.webpackJsonp||[]).push([[507],{2922:function(e,t,o){"use strict";o(11),o(12),o(67),o(55),o(19),o(28);function r(e,t){var o=new URL(e);return t.includes(o.hostname)&&("https:"===o.protocol||"http:"===o.protocol)}var n=o(1).a.extend({inheritAttrs:!1,props:{src:{type:String,required:!0},title:{type:String,required:!0}},computed:{isValidSrc(){if(!this.src)return!1;try{return r(this.src,["www.youtube.com","youtube.com","m.youtube.com","youtu.be"])||function(e){return r(e,["vimeo.com","player.vimeo.com"])}(this.src)}catch(e){return console.error(e),!1}}}}),l=o(7),component=Object(l.a)(n,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("client-only",[e.isValidSrc?o("iframe",e._b({attrs:{src:e.src,title:e.title}},"iframe",e.$attrs,!1)):o("span")])}),[],!1,null,null,null);t.a=component.exports},4686:function(e,t,o){var content=o(5746);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,o(16).default)("e2e38724",content,!0,{sourceMap:!1})},5745:function(e,t,o){"use strict";o(4686)},5746:function(e,t,o){var r=o(15)((function(i){return i[1]}));r.push([e.i,".o-editMovieNoteForm__count[data-v-75f2f4cb]{display:flex;justify-content:flex-end;margin-top:8px;font-size:var(--font-size-sm);color:var(--color-text-secondary)}.o-editMovieNoteForm__item[data-v-75f2f4cb]{padding-right:24px;padding-left:24px;margin-top:24px;margin-bottom:24px}@media only screen and (max-width:480px){.o-editMovieNoteForm__item[data-v-75f2f4cb]{padding-right:16px;padding-left:16px;margin-top:16px;margin-bottom:16px}}.o-editMovieNoteForm__item[data-v-75f2f4cb]:empty{padding:0;margin:0}.o-editMovieNoteForm__iframe[data-v-75f2f4cb]{width:100%;height:260px}",""]),r.locals={},e.exports=r},6778:function(e,t,o){"use strict";o.r(t);var r=o(0),n=(o(11),o(26),o(12),o(139),o(14),o(64),o(19),o(557)),l=o(45),d=o(162),c=o(17),m=o(111),h=o(204),v=o(54),_=o(9),f=o(108),x=o(68),E=o(2922),N=o(73),T=o(113),y=o(251),M=o(83),w=o(285),U=o(155),O=o(206),$=o(82),F=o(205),C=o(208),P={components:{NtMovieIframe:E.a,NtModal:N.a,FormInput:T.a,FormTextarea:y.a,FormErrorList:M.a,FileContainer:w.a,ModalHeading:U.a,NoteEditModalFooter:O.a,AdvancedPostSetting:()=>Promise.all([o.e(9),o.e(42),o.e(146)]).then(o.bind(null,6672)),BasicModalContent:$.a,HashtagInput:F.a,HashtagOnBoarding:C.a},mixins:[h.a,v.a],data:()=>({submitting:!1}),computed:{currentNote(){return this.$store.state.modal.noteEditMovieNoteModal.note},name:{get(){return this.$store.state.noteEdit.note.name},set(e){this.$store.commit(_.NOTE_EDIT_MUTATION_TYPES.SET_NOTE,{name:e})}},maxNameLength:()=>m.maxNameLength,description:{get(){return this.$store.state.noteEdit.note.description},set(e){this.$store.commit(_.NOTE_EDIT_MUTATION_TYPES.SET_NOTE,{description:e})}},externalUrl:{get(){return this.$store.state.noteEdit.note.externalUrl},set(e){var t=this.extractURL(e);t&&this.$store.commit(_.NOTE_EDIT_MUTATION_TYPES.SET_NOTE,{externalUrl:t,movielUrl:e})}},areHashtagsInvalid(){var{errors:e}=this.$store.state.noteEdit;return e.contestHashtags.invalid||e.themeHashtags.invalid||e.normalHashtags.invalid},hasFormError(){return this.$v.name.$invalid||!this.$v.externalUrl.required||this.areHashtagsInvalid}},validations:{name:{required:l.required,maxLength:Object(l.maxLength)(m.maxNameLength)},externalUrl:{required:l.required}},methods:{extractURL(e){var t,o=null,r=Object(x.d)(e);return r&&(o=Object(x.b)(r)),(t=e.match("vimeo.com/([0-9]+)")||e.match("player.vimeo.com/video/([0-9]+)"))&&(o="https://player.vimeo.com/video/".concat(t[1])),(t=e.match("instagram.com/p/([a-zA-Z-0-9_-]+)"))&&(o="https://instagram.com/p/".concat(t[1],"/embed/")),(t=e.match("vine.co/v/([a-zA-Z-0-9_-]+)"))&&(o="https://vine.co/v/".concat(t[1],"/embed/simple")),o},deleteExternalUrl(){this.$store.dispatch(_.NOTE_EDIT_ACTION_TYPES.SET_NOTE,{externalUrl:null})},init(){this.isEdit?(this.$store.dispatch(_.NOTE_EDIT_ACTION_TYPES.SET_CURRENT_NOTE,this.currentNote),this.initEditForm()):(this.$store.dispatch(_.NOTE_EDIT_ACTION_TYPES.SET_DEFAULT_NOTE,"MovieNote"),this.initForm()),this.mountModals("noteEditFinishPostNote","noteEditNotifyUpdate","reservedNote")},save(){var e=this;return Object(r.a)((function*(){if(!e.submitting&&!e.hasFormError){var t=e.$store.getters["noteEdit/isInitialPublishing"];if(t){var o=c.k.extractAll(e.note.body);if(!Object(f.a)(e.settings.openedContests,o))return}if(e.submitting=!0,e.normalizeSettings(),e.isEdit){var r,l={status:["frozen","private"].includes(e.note.status)?e.note.status:"published",name:e.note.name,external_url:e.note.externalUrl,description:e.note.description,hashtags:e.settings.hashtags.map((e=>e)),magazine_ids:e.magazineIdsFromKeys,limited:e.settings.limited,publish_at:e.settings.reserved||e.note.isDraft?e.settings.publishAt:null,send_notifications_flag:e.settings.enableSendNotifications,circle_permissions:e.circlePermissions,exclude_from_creator_top:e.note.excludeFromCreatorTop};e.currentUser.turnoffCommentAvailable&&(l.disable_comment=!1===e.settings.enableComment);try{r=yield e.$store.dispatch(_.NOTE_EDIT_ACTION_TYPES.UPDATE_NOTE,{note:e.note,params:l}),e.submitting=!1}catch(t){var d=Object(n.a)(t,"response.data.error.message");return alert(d||"エラーが発生しました。"),void(e.submitting=!1)}if(r.data.firstNoteUserPopupFlag)return void e.transitionToFirstPostPage(r.data.key);if(!0===e.settings.reserved){e.replaceReservedNoteModal({publishAt:e.settings.publishAt,closeCallback:()=>{var path=e.$path.contentPath({contentType:"note",content:r.data});Object(x.e)(path)?window.location.href=path:e.$router.push(path),e.popModal()}})}else if((r.data.existPurchasedUser||r.data.existSubscribedMembershipUser)&&r.data.contentChanged)e.replaceNoteEditNotifyUpdateModal();else if(t)e.replaceNoteEditFinishPostNoteModal();else{e.replaceAnyMessageModal({message:"記事が公開されました",closeCallback:()=>{var path=e.$path.contentPath({contentType:"note",content:e.note});Object(x.e)(path)?window.location.href=path:e.$router.push(path),e.popModal()}})}}else{var m,h={status:"published",name:e.note.name,external_url:e.note.externalUrl,description:e.note.description||null,hashtags:e.settings.hashtags.map((e=>e)),magazine_ids:e.magazineIdsFromKeys,limited:e.settings.limited,publish_at:e.settings.publishAt,send_notifications_flag:e.settings.enableSendNotifications,circle_permissions:e.circlePermissions,exclude_from_creator_top:e.note.excludeFromCreatorTop};e.currentUser.turnoffCommentAvailable&&(h.disable_comment=!1===e.settings.enableComment);try{m=yield e.$store.dispatch(_.NOTE_EDIT_ACTION_TYPES.CREATE_NOTE,{params:h,noteType:"MovieNote"}),e.submitting=!1}catch(t){var v=Object(n.a)(t,"response.data.error.message");return alert(v||"エラーが発生しました。"),void(e.submitting=!1)}if(m.data.firstNoteUserPopupFlag)return void e.transitionToFirstPostPage(m.data.key);if(e.settings.reserved){e.replaceReservedNoteModal({publishAt:e.settings.publishAt,closeCallback:()=>{var path=e.$path.contentPath({contentType:"note",content:m.data});Object(x.e)(path)?window.location.href=path:e.$router.push(path),e.popModal()}})}else m.data.existPurchasedUser&&m.data.contentChanged?e.replaceNoteEditNotifyUpdateModal():e.replaceNoteEditFinishPostNoteModal()}}}))()},saveDraft(){var e=this;return Object(r.a)((function*(){if(!e.submitting&&!e.hasFormError){if(e.submitting=!0,e.alertDraftSave(),e.normalizeSettings(),e.isEdit){var t={status:"draft",name:e.note.name,external_url:e.note.externalUrl,description:e.note.description,magazine_ids:e.magazineIdsFromKeys,limited:e.settings.limited,hashtags:e.settings.hashtags.map((e=>e)),publish_at:e.note.isReserved?e.settings.publishAt:null,circle_permissions:e.circlePermissions,exclude_from_creator_top:e.note.excludeFromCreatorTop};try{yield e.$store.dispatch(_.NOTE_EDIT_ACTION_TYPES.UPDATE_NOTE,{note:e.note,params:t,isDraft:!0}),e.submitting=!1}catch(t){var o=Object(n.a)(t,"response.data.error.message");return alert(o||"エラーが発生しました。"),void(e.submitting=!1)}}else{var r={status:"draft",name:e.note.name,external_url:e.note.externalUrl,description:e.note.description,magazine_ids:e.magazineIdsFromKeys,limited:e.settings.limited,hashtags:e.settings.hashtags.map((e=>e)),publish_at:e.note.isReserved?e.settings.publishAt:null,circle_permissions:e.circlePermissions,exclude_from_creator_top:e.note.excludeFromCreatorTop};try{yield e.$store.dispatch(_.NOTE_EDIT_ACTION_TYPES.CREATE_NOTE,{params:r,noteType:"MovieNote",isDraft:!0}),e.submitting=!1}catch(t){var l=Object(n.a)(t,"response.data.error.message");return alert(l||"エラーが発生しました。"),void(e.submitting=!1)}}e.popModal(),e.pushAnyMessageModal({message:e.draftSaveMessage})}}))()},cancel(){this.note.externalUrl?this.cancelEditConfirm()&&this.popModal():this.popModal()},transitionToFirstPostPage(e){this.popModal();var t=this.$config.currentEnv;Object(d.a)({router:this.$router,currentOrigin:"object"==typeof window?window.location.origin:"",currentEnv:"test"===t||!1===Boolean(t)?"development":t,isCustomDomain:null!==this.$path.customDomain}).push(void 0,"firstPost",{key:e})}}},A=(o(5745),o(7)),component=Object(A.a)(P,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("nt-modal",{attrs:{"disable-backdrop":!0,name:"noteEditMovieNote"},on:{"before-open":function(t){return e.init()},"before-close":function(t){e.loaded=!1},"esc-key":function(t){return e.cancel()}}},[o("basic-modal-content",{staticClass:"o-editMovieNoteForm",attrs:{size:"medium"}},[e.isEdit?e._e():o("modal-heading",{attrs:{slot:"header"},slot:"header"},[e._v("\n      動画の投稿\n    ")]),e._v(" "),o("div",{staticClass:"o-editMovieNoteForm__body",attrs:{slot:"body"},slot:"body"},[e.isEdit?o("modal-heading",{staticClass:"visually-hidden"},[e._v("\n        動画投稿の編集\n      ")]):e._e(),e._v(" "),e.note.externalUrl?e._e():o("div",{staticClass:"o-editMovieNoteForm__item"},[o("form-input",{attrs:{id:"externalUrl",value:e.note.movielUrl,label:"動画URLを貼り付けてください",placeholder:"例：https://www.youtube.com/watch?v=***",type:"text"},model:{value:e.externalUrl,callback:function(t){e.externalUrl="string"==typeof t?t.trim():t},expression:"externalUrl"}},[o("template",{slot:"description"},[e._v("\n            YouTube または vimeoのみ対応しています。\n          ")])],2)],1),e._v(" "),e.note.externalUrl?o("div",{staticClass:"o-editMovieNoteForm__item"},[o("file-container",{on:{"delete-content":e.deleteExternalUrl}},[o("nt-movie-iframe",{staticClass:"o-editMovieNoteForm__iframe",attrs:{src:e.note.externalUrl,title:"記事 "+(e.name||"")+"の動画",frameborder:"0",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:""}})],1)],1):e._e(),e._v(" "),o("div",{staticClass:"o-editMovieNoteForm__item"},[o("form-input",{directives:[{name:"show",rawName:"v-show",value:e.note.externalUrl,expression:"note.externalUrl"}],attrs:{id:"name","has-error":e.$v.name.$error,label:"動画のタイトル",placeholder:"例：オススメの風景",type:"text"},on:{input:e.$v.name.$touch},model:{value:e.name,callback:function(t){e.name="string"==typeof t?t.trim():t},expression:"name"}},[o("form-error-list",{directives:[{name:"show",rawName:"v-show",value:e.$v.name.$error,expression:"$v.name.$error"}],attrs:{slot:"errorMessage"},slot:"errorMessage"},[o("div",{directives:[{name:"show",rawName:"v-show",value:!e.$v.name.required&&e.$v.name.$dirty,expression:"!$v.name.required && $v.name.$dirty"}]},[e._v("\n              タイトルを入力してください。\n            ")]),e._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:!e.$v.name.maxLength,expression:"!$v.name.maxLength"}]},[e._v("\n              タイトルは"+e._s(e.maxNameLength)+"文字以内で入力してください。\n            ")])])],1)],1),e._v(" "),o("div",{staticClass:"o-editMovieNoteForm__item"},[o("form-textarea",{directives:[{name:"show",rawName:"v-show",value:e.note.externalUrl,expression:"note.externalUrl"}],attrs:{id:"description",label:"動画の説明",placeholder:"例：この動画すごくオススメです"},model:{value:e.description,callback:function(t){e.description=t},expression:"description"}})],1),e._v(" "),e.note.externalUrl&&e.loaded?o("div",{staticClass:"o-editMovieNoteForm__item"},[o("hashtag-on-boarding")],1):e._e(),e._v(" "),e.loaded?o("div",{directives:[{name:"show",rawName:"v-show",value:e.note.externalUrl,expression:"note.externalUrl"}],staticClass:"o-editMovieNoteForm__item"},[o("hashtag-input",{attrs:{hashtags:e.settings.hashtags,note:e.note,"opened-contests":e.settings.openedContests,"suggested-hashtags":e.settings.suggestedHashtags}})],1):e._e(),e._v(" "),o("div",{staticClass:"o-editMovieNoteForm__item"},[e.loaded?o("advanced-post-setting",{directives:[{name:"show",rawName:"v-show",value:e.note.externalUrl,expression:"note.externalUrl"}],attrs:{settings:e.settings,magazines:e.magazines,note:e.note,reservation:e.reservation,memberships:e.memberships}}):e._e()],1)],1),e._v(" "),o("note-edit-modal-footer",{attrs:{slot:"footer","show-draft-button":!e.hasFormError&&e.loaded&&"draft"==e.note.status&&!e.settings.reserved,"disabled-button":e.hasFormError||!e.loaded,reserved:e.settings.reserved},on:{save:e.save,saveDraft:e.saveDraft,close:function(t){return e.cancel()}},slot:"footer"})],1)],1)}),[],!1,null,"75f2f4cb",null);t.default=component.exports}}]);