(window.webpackJsonp=window.webpackJsonp||[]).push([[414],{3617:function(e,t,n){"use strict";var o=n(1),r=n(43),l=n(377),c=n(33),d=o.a.extend({components:{NtButton:r.a,NtIcon:c.default,NtIconLabel:l.a},props:{membershipItem:{type:Object,required:!0},isWhole:{type:Boolean,default:!1}},data:()=>({isProcessing:!1}),computed:{imageUrl(){return this.membershipItem.headerImagePath},enableLockIcon(){return!this.membershipItem.isEveryoneVisible}},methods:{select(e){this.isProcessing||(this.isProcessing=!0,this.$emit("membership-selected",{membershipItem:e,callback:()=>{this.isProcessing=!1}}))}}}),m=n(7),h=Object(m.a)(d,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"relative flex py-[8px] px-[16px]"},[n("div",{staticClass:"flex flex-1 items-center"},[n("div",{staticClass:"`\n        relative w-[70px] sm:w-[80px] h-[40px] bg-surface-disabled bg-center bg-cover rounded-lg\n      `",style:{backgroundImage:e.imageUrl?"url("+e.imageUrl+")":void 0}},[e.enableLockIcon?n("div",{class:"\n          absolute top-[-5px] left-[-5px] w-[20px] h-[20px] p-[2px] bg-background-primary rounded-full\n        "},[n("nt-icon-label",{attrs:{type:"lock","aria-label":"非公開"}}),e._v(" "),n("nt-icon",{attrs:{clickable:!1,type:"lock",size:"small"}})],1):e._e()]),e._v(" "),n("p",{class:"\n      flex mx-[8px] sm:mx-[16px] font-bold text-text-primary break-all text-sm\n    "},[e._v("\n      "+e._s(e.isWhole?"メンバー全員に公開":e.membershipItem.name)+"\n    ")])]),e._v(" "),n("div",[e.membershipItem.isSelected?n("nt-button",{attrs:{disabled:e.isProcessing,size:"small",type:"secondary",width:"fit"},on:{click:function(t){return e.select(e.membershipItem)}}},[e._v("\n      追加済\n    ")]):n("nt-button",{attrs:{disabled:e.isProcessing,size:"small",type:"basic",width:"fit"},on:{click:function(t){return e.select(e.membershipItem)}}},[e._v("\n      追加\n    ")])],1)])}),[],!1,null,null,null).exports,_=n(44),y=o.a.extend({name:"MembershipList",components:{MembershipListItem:h,NtLink:_.default,NtIcon:c.default},props:{memberships:{type:Array,default:()=>[]},isShowTitle:{type:Boolean,default:!0},hasWholeMembership:{type:Boolean,default:!0}},computed:{membership(){return this.memberships[0].circle},membershipPlans(){return this.memberships[0].circlePlans}}}),f=Object(m.a)(y,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e.isShowTitle?n("div",{staticClass:"sticky top-0 z-[2] flex align-center px-[16px] py-[8px] bg-background-secondary"},[n("p",{staticClass:"text-xs"},[e._v("\n      メンバーシップ\n    ")]),e._v(" "),n("nt-link",{staticClass:"leading-none text-text-clickable-icon md:hover:text-text-secondary ml-auto",attrs:{to:"https://www.help-note.com/hc/ja/articles/900000163906-%E3%82%B5%E3%83%BC%E3%82%AF%E3%83%AB%E3%81%A8%E3%81%AF",target:"_blank","aria-label":"ヘルプ"}},[n("nt-icon",{attrs:{clickable:!1,size:"small",type:"help"}})],1)],1):e._e(),e._v(" "),n("div",{staticClass:"py-[8px]"},[e.hasWholeMembership?n("membership-list-item",{staticClass:"mb-[16px]",attrs:{"membership-item":e.membership,"is-whole":!0},on:{"membership-selected":function(t){return e.$emit("all-selected",t)}}}):e._e(),e._v(" "),n("p",{staticClass:"mb-[8px] ml-[16px] font-bold text-text-primary text-sm"},[e._v("\n      プラン限定公開\n    ")]),e._v(" "),e.membershipPlans.length>0?n("ul",e._l(e.membershipPlans,(function(t){return n("li",{key:t.key},[n("membership-list-item",{attrs:{"membership-item":t},on:{"membership-selected":function(t){return e.$emit("plan-selected",t)}}})],1)})),0):n("p",{staticClass:"text-sm ml-[16px]"},[e._v("\n      まだプランがありません\n    ")])],1)])}),[],!1,null,null,null);t.a=f.exports},3862:function(e,t,n){var content=n(4255);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(16).default)("5de6cb70",content,!0,{sourceMap:!1})},3863:function(e,t,n){var content=n(4257);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(16).default)("c10019ac",content,!0,{sourceMap:!1})},4254:function(e,t,n){"use strict";n(3862)},4255:function(e,t,n){var o=n(15)((function(i){return i[1]}));o.push([e.i,".o-topicListItem[data-v-7526e260]{position:relative;display:flex;align-items:center;padding:8px 16px;border-bottom:1px solid var(--color-border-default)}.o-topicListItem__content[data-v-7526e260]{flex:1}.o-topicListItem__name[data-v-7526e260]{font-size:var(--font-size-sm);font-weight:600;word-break:break-all}.o-topicListItem__subname[data-v-7526e260]{font-size:var(--font-size-xs);color:var(--color-text-secondary)}",""]),o.locals={},e.exports=o},4256:function(e,t,n){"use strict";n(3863)},4257:function(e,t,n){var o=n(15)((function(i){return i[1]}));o.push([e.i,".o-topicList[data-v-89b4daa2]{background-color:var(--color-surface-normal)}.o-topicList__icon[data-v-89b4daa2]{margin-right:8px}.o-topicList__title[data-v-89b4daa2]{position:-webkit-sticky;position:sticky;top:0;z-index:2;padding:8px 16px;font-size:var(--font-size-xs);color:var(--color-text-secondary);background-color:var(--color-background-secondary)}",""]),o.locals={},e.exports=o},4258:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var o=e=>"object"==typeof e&&null!==e&&"code"in e&&"message"in e},4261:function(e,t,n){"use strict";n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return c}));var o=n(0),r=n(613),l=function(){var e=Object(o.a)((function*(e){var{vue:t,membershipItem:n,callback:o,note:l}=e;yield t.$store.dispatch(r.MEMBERSHIP_LIST_ACTION_TYPES.UPDATE_MEMBERSHIP,{membership:n,noteKey:l.key||""}),o()}));return function(t){return e.apply(this,arguments)}}(),c=function(){var e=Object(o.a)((function*(e){var{vue:t,membershipItem:n,callback:o,note:l}=e;yield t.$store.dispatch(r.MEMBERSHIP_LIST_ACTION_TYPES.UPDATE_MEMBERSHIP_PLAN,{membershipPlan:n,noteKey:l.key||""}),o()}));return function(t){return e.apply(this,arguments)}}()},4364:function(e,t,n){"use strict";var o=n(0),r=n(1),l=n(43),c=r.a.extend({components:{NtButton:l.a},props:{item:{type:Object,required:!0},note:{type:Object,required:!0}},data(){return{selected:this.item.selected,isProcessing:!1}},methods:{add(){this.isProcessing||(this.isProcessing=!0,this.$emit("add",this.item,this.note,(()=>{this.isProcessing=!1,this.toggleSelected()})))},del(){this.isProcessing||(this.isProcessing=!0,this.$emit("del",this.item,this.note,(()=>{this.isProcessing=!1,this.toggleSelected()})))},toggleSelected(){this.selected=!this.selected}}}),d=(n(4254),n(7)),m=Object(d.a)(c,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"o-topicListItem"},[n("div",{staticClass:"o-topicListItem__content"},[n("p",{staticClass:"o-topicListItem__name"},[e._v("\n      "+e._s(e.item.name)+"\n    ")]),e._v(" "),e.item.pageTabname?n("p",{staticClass:"o-topicListItem__subname"},[e._v("\n      "+e._s(e.item.pageTabname)+"\n    ")]):e._e()]),e._v(" "),n("div",{staticClass:"o-topicListItem__action"},[n("div",{staticClass:"o-topicListItem__button"},[e.selected?n("nt-button",{attrs:{disabled:e.isProcessing,size:"small",type:"secondary",width:"fit"},on:{click:function(t){return e.del()}}},[e._v("\n        追加済\n      ")]):n("nt-button",{attrs:{disabled:e.isProcessing,size:"small",type:"basic",width:"fit"},on:{click:function(t){return e.add()}}},[e._v("\n        追加\n      ")])],1)])])}),[],!1,null,"7526e260",null).exports,h=n(33),_=(n(18),n(130));function y(){return(y=Object(o.a)((function*(e,t,n,o){var r=yield Object(_.a)(e,"/v3/datasets/content/notes","POST",n,o);return(yield e.post(r.apiUrl,t,r.config)).data}))).apply(this,arguments)}function f(){return(f=Object(o.a)((function*(e,t,n,o,r){var l="/v3/datasets/content/notes/".concat(t),c=yield Object(_.a)(e,l,"DELETE",o,r);yield e.delete(c.apiUrl,Object.assign({data:n},c.config))}))).apply(this,arguments)}var v=r.a.extend({components:{TopicListItem:m,NtIcon:h.default},props:{topics:{type:Array,required:!0},note:{type:Object,required:!0}},methods:{addTopicSection(section,e,t){this.add((()=>this.$store.dispatch("topic/topicList/add",this.sectionParams(section,e))),t)},delTopicSection(section,e,t){this.del((()=>this.$store.dispatch("topic/topicList/delete",this.sectionParams(section,e))),t)},addDataset(e,t,n){var r=this;this.add(Object(o.a)((function*(){return yield function(e,t,n,o){return y.apply(this,arguments)}(r.$axios,r.datasetParams(e,t),r.$path.customDomain,r.$path.currentNoteHeadUrl)})),n)},delDataset(e,t,n){var r=this;this.del(Object(o.a)((function*(){return yield function(e,t,n,o,r){return f.apply(this,arguments)}(r.$axios,r.note.id,r.datasetParams(e,t),r.$path.customDomain,r.$path.currentNoteHeadUrl)})),n)},sectionParams:(section,e)=>({topicId:section.topicId,topicPageId:section.topicPageId,topicSectionId:section.id,contentType:"notes",contentId:e.id}),datasetParams:(e,t)=>({dataset_group_key:e.datasetGroupKey,dataset_key:e.key,content_id:t.id}),add:(e,t)=>Object(o.a)((function*(){try{yield e(),t()}catch(e){alert("更新が失敗しました。")}}))(),del:(e,t)=>Object(o.a)((function*(){try{yield e(),t()}catch(e){alert("削除が失敗しました。")}}))()}}),I=v,T=(n(4256),Object(d.a)(I,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"o-topicList"},[n("div",{staticClass:"o-topicList__body"},e._l(e.topics,(function(t){return n("div",{key:t.id,staticClass:"o-topicList__item"},[n("p",{staticClass:"o-topicList__title"},[n("nt-icon",{staticClass:"o-topicList__icon",attrs:{clickable:!1,type:"topic",size:"small"}}),e._v("\n        "+e._s(t.name)+"\n      ")],1),e._v(" "),e._l(t.sections,(function(section){return n("topic-list-item",{key:section.id,attrs:{item:section,note:e.note},on:{add:e.addTopicSection,del:e.delTopicSection}})})),e._v(" "),e._l(t.datasets,(function(t){return n("topic-list-item",{key:t.key,attrs:{item:t,note:e.note},on:{add:e.addDataset,del:e.delDataset}})}))],2)})),0)])}),[],!1,null,"89b4daa2",null));t.a=T.exports},6684:function(e,t,n){"use strict";n.r(t);var o=n(0),r=(n(11),n(26),n(12),n(1)),l=n(54),c=n(586),d=n(73),m=n(43),h=n(82),_=n(155),y=n(138),f=n(4359),v=n(4364),I=n(613),T=n(3617),M=n(35),E=n(4258),x=function(){var e=Object(o.a)((function*(e){var{vue:t,magazineTitle:n,currentUser:o}=e;try{yield t.$store.dispatch(c.MAGAZINE_LIST_ACTION_TYPES.CREATE_MAGAZINE,n)}catch(e){"magazine_count_exceeded"===e.code?alert("作成可能なマガジンは".concat(o.maxMagazineAddCount,"個までです。")):alert("エラーが発生しました。")}}));return function(t){return e.apply(this,arguments)}}(),z=function(){var e=Object(o.a)((function*(e){var{vue:t,magazine:n,callback:o,currentUser:r,selectedMagazineIds:l}=e,d={magazine:n,multipleLimited:!0===r.canMultipleLimitedNote},m=[];try{if(n.selected){yield t.$store.dispatch(c.MAGAZINE_LIST_ACTION_TYPES.REMOVE_FROM_MAGAZINE,d);var h=l.indexOf(n.id);m=[...l.slice(0,h),...l.slice(h+1)]}else yield t.$store.dispatch(c.MAGAZINE_LIST_ACTION_TYPES.ADD_TO_MAGAZINE,d),m=[...l,n.id]}catch(e){var _=Object(E.a)(e)?e.message:"エラーが発生しました。";t.$store.dispatch(M.FLASH_MESSAGE_ACTION_TYPES.SHOW_FLASH,{text:_,type:"error"},{root:!0})}finally{o()}return m}));return function(t){return e.apply(this,arguments)}}(),A=n(4261),S=r.a.extend({components:{NtButton:m.a,MagazineList:f.a,TopicList:v.a,BasicModalContent:h.a,ModalHeading:_.a,NtLoadingDots:y.a,NtModal:d.a,MembershipList:T.a},mixins:[l.a],data:()=>({isLoading:!0,myMagazines:null,magazines:[],listType:"",limitedTitle:"",selectedMagazineIds:[]}),computed:{note(){return this.$store.state.modal.commonAddNoteModal.note},location(){return this.$store.state.modal.commonAddNoteModal.location},topics(){return this.$store.state.topic.topicList.mylist},memberships(){return this.$store.state.membershipList.membershipPermissions}},methods:{init(){var e=this;return Object(o.a)((function*(){yield e.prepare(),yield e.load(),e.initMagazineList()}))()},reset(){this.isLoading=!0,this.myMagazines=null,this.magazines=[],this.listType="",this.limitedTitle="",this.selectedMagazineIds=[]},prepare(){var e=this;return Object(o.a)((function*(){yield e.$store.dispatch(c.MAGAZINE_LIST_ACTION_TYPES.SET_NOTE,e.note)}))()},load(){var e=this;return Object(o.a)((function*(){var t=[e.$store.dispatch(c.MAGAZINE_LIST_ACTION_TYPES.GET_MY_MAGAZINES)];"TextNote"===e.note.type&&t.push(e.$store.dispatch("topic/topicList/fetch",{noteId:e.note.id})),e.note.isMyNote||e.note.isAuthor?t.push(e.$store.dispatch(I.MEMBERSHIP_LIST_ACTION_TYPES.FETCH_MEMBERSHIP_PERMISSIONS,e.note.key||"")):yield e.$store.dispatch(I.MEMBERSHIP_LIST_ACTION_TYPES.CLEAR_MEMBERSHIP_PERMISSIONS),yield Promise.all(t),e.myMagazines=e.$store.state.magazineList.myMagazineData,e.isLoading=!1}))()},initMagazineList(){var{magazines:e,listType:t,limitedTitle:n}=(e=>{var{vue:t,myMagazines:n,note:o,currentUser:r}=e;if(n.limitedNoteIncludedMagazineKeys.length<0)return{magazines:[],listType:"",limitedTitle:""};if(0===n.limitedNoteIncludedMagazineKeys.length)return{magazines:n.magazines,listType:"normal",limitedTitle:""};if(o.price<0)return{magazines:[],listType:"",limitedTitle:""};if(0===o.price){var l="有料マガジンで公開中";return r.canMultipleLimitedNote?{magazines:t.$store.getters[c.MAGAZINE_LIST_GETTER_TYPES.GET_MY_MAGAZINES],listType:"multipleLimitedPublish",limitedTitle:l}:{magazines:t.$store.getters[c.MAGAZINE_LIST_GETTER_TYPES.SEARCH_MY_MAGAZINES]({key:n.limitedNoteIncludedMagazineKeys}),listType:"limitedPublish",limitedTitle:l}}var d=t.$store.getters[c.MAGAZINE_LIST_GETTER_TYPES.SEARCH_MY_MAGAZINES]({key:n.limitedNoteIncludedMagazineKeys});return d.length<=0?{magazines:[],listType:"",limitedTitle:""}:{magazines:[d[0]],listType:"limitedSell",limitedTitle:"限定販売中"}})({vue:this,myMagazines:this.myMagazines,note:this.note,currentUser:this.currentUser});this.magazines=e,this.listType=t,this.limitedTitle=n},onMagazineSelected(e){var t=this;return Object(o.a)((function*(){var{magazine:n,callback:o}=e;t.selectedMagazineIds=yield z({vue:t,magazine:n,callback:o,currentUser:t.currentUser,selectedMagazineIds:t.selectedMagazineIds}),t.initMagazineList(),t.$tracker.trackActionLogs([t.$tracker.buildActionLogRecord({kind:"add-note-to-magazine-finish",contents:{magazine_name:n.name,magazine_status:n.status,magazine_key:n.key,note_key:t.note.key,route_name:t.$route.name,experiment_info:{}}})])}))()},createMagazine(e){var t=this;return Object(o.a)((function*(){yield x({vue:t,magazineTitle:e,currentUser:t.currentUser})}))()},handleAllMembershipSelected(e){var t=this;return Object(o.a)((function*(){var{membershipItem:n,callback:o}=e;yield Object(A.a)({vue:t,membershipItem:n,callback:o,note:t.note})}))()},handleMembershipPlanSelected(e){var t=this;return Object(o.a)((function*(){var{membershipItem:n,callback:o}=e;yield Object(A.b)({vue:t,membershipItem:n,callback:o,note:t.note})}))()},close(){this.popModal(),this.selectedMagazineIds.length>0&&this.$store.commit(c.MAGAZINE_LIST_MUTATION_TYPES.SET_NOTE_ADDED_TO_MAGAZINE,{noteId:this.note.id,location:this.location})}}}),k=n(7),component=Object(k.a)(S,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("nt-modal",{attrs:{name:"commonAddNote","disable-backdrop":!0},on:{"before-open":e.init,"before-close":e.reset}},[n("basic-modal-content",{directives:[{name:"click-outside",rawName:"v-click-outside",value:e.close,expression:"close"}],staticClass:"o-commonAddNote"},[n("modal-heading",{staticClass:"flex items-baseline justify-center",attrs:{slot:"header"},slot:"header"},[e._v("\n      記事を追加\n    ")]),e._v(" "),n("div",{staticClass:"max-h-[400px] overflow-auto",attrs:{slot:"body"},slot:"body"},[e.isLoading?[n("nt-loading-dots",{staticClass:"h-[50px]",attrs:{slot:"body"},slot:"body"})]:[e.memberships.length>0?n("membership-list",{attrs:{memberships:e.memberships},on:{"all-selected":e.handleAllMembershipSelected,"plan-selected":e.handleMembershipPlanSelected}}):e._e(),e._v(" "),n("magazine-list",{attrs:{magazines:e.magazines,"list-type":e.listType,"limited-title":e.limitedTitle,"enable-magazine-links":!0},on:{"magazine-selected":function(t){return e.onMagazineSelected(t)},"create-magazine":function(t){return e.createMagazine(t)}}}),e._v(" "),n("topic-list",{attrs:{topics:e.topics,note:e.note}})]],2),e._v(" "),n("nt-button",{attrs:{slot:"footer",size:"small",type:"basic"},on:{click:e.close},slot:"footer"},[e._v("\n      閉じる\n    ")])],1)],1)}),[],!1,null,null,null);t.default=component.exports}}]);