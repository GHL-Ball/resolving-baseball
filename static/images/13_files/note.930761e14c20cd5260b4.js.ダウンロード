(window.webpackJsonp=window.webpackJsonp||[]).push([[410],{3862:function(t,e,o){var content=o(4255);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,o(16).default)("5de6cb70",content,!0,{sourceMap:!1})},3863:function(t,e,o){var content=o(4257);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,o(16).default)("c10019ac",content,!0,{sourceMap:!1})},4254:function(t,e,o){"use strict";o(3862)},4255:function(t,e,o){var n=o(15)((function(i){return i[1]}));n.push([t.i,".o-topicListItem[data-v-7526e260]{position:relative;display:flex;align-items:center;padding:8px 16px;border-bottom:1px solid var(--color-border-default)}.o-topicListItem__content[data-v-7526e260]{flex:1}.o-topicListItem__name[data-v-7526e260]{font-size:var(--font-size-sm);font-weight:600;word-break:break-all}.o-topicListItem__subname[data-v-7526e260]{font-size:var(--font-size-xs);color:var(--color-text-secondary)}",""]),n.locals={},t.exports=n},4256:function(t,e,o){"use strict";o(3863)},4257:function(t,e,o){var n=o(15)((function(i){return i[1]}));n.push([t.i,".o-topicList[data-v-89b4daa2]{background-color:var(--color-surface-normal)}.o-topicList__icon[data-v-89b4daa2]{margin-right:8px}.o-topicList__title[data-v-89b4daa2]{position:-webkit-sticky;position:sticky;top:0;z-index:2;padding:8px 16px;font-size:var(--font-size-xs);color:var(--color-text-secondary);background-color:var(--color-background-secondary)}",""]),n.locals={},t.exports=n},4258:function(t,e,o){"use strict";o.d(e,"a",(function(){return n}));var n=t=>"object"==typeof t&&null!==t&&"code"in t&&"message"in t},4364:function(t,e,o){"use strict";var n=o(0),c=o(1),l=o(43),d=c.a.extend({components:{NtButton:l.a},props:{item:{type:Object,required:!0},note:{type:Object,required:!0}},data(){return{selected:this.item.selected,isProcessing:!1}},methods:{add(){this.isProcessing||(this.isProcessing=!0,this.$emit("add",this.item,this.note,(()=>{this.isProcessing=!1,this.toggleSelected()})))},del(){this.isProcessing||(this.isProcessing=!0,this.$emit("del",this.item,this.note,(()=>{this.isProcessing=!1,this.toggleSelected()})))},toggleSelected(){this.selected=!this.selected}}}),r=(o(4254),o(7)),m=Object(r.a)(d,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"o-topicListItem"},[o("div",{staticClass:"o-topicListItem__content"},[o("p",{staticClass:"o-topicListItem__name"},[t._v("\n      "+t._s(t.item.name)+"\n    ")]),t._v(" "),t.item.pageTabname?o("p",{staticClass:"o-topicListItem__subname"},[t._v("\n      "+t._s(t.item.pageTabname)+"\n    ")]):t._e()]),t._v(" "),o("div",{staticClass:"o-topicListItem__action"},[o("div",{staticClass:"o-topicListItem__button"},[t.selected?o("nt-button",{attrs:{disabled:t.isProcessing,size:"small",type:"secondary",width:"fit"},on:{click:function(e){return t.del()}}},[t._v("\n        追加済\n      ")]):o("nt-button",{attrs:{disabled:t.isProcessing,size:"small",type:"basic",width:"fit"},on:{click:function(e){return t.add()}}},[t._v("\n        追加\n      ")])],1)])])}),[],!1,null,"7526e260",null).exports,_=o(33),h=(o(18),o(130));function f(){return(f=Object(n.a)((function*(t,e,o,n){var c=yield Object(h.a)(t,"/v3/datasets/content/notes","POST",o,n);return(yield t.post(c.apiUrl,e,c.config)).data}))).apply(this,arguments)}function y(){return(y=Object(n.a)((function*(t,e,o,n,c){var l="/v3/datasets/content/notes/".concat(e),d=yield Object(h.a)(t,l,"DELETE",n,c);yield t.delete(d.apiUrl,Object.assign({data:o},d.config))}))).apply(this,arguments)}var v=c.a.extend({components:{TopicListItem:m,NtIcon:_.default},props:{topics:{type:Array,required:!0},note:{type:Object,required:!0}},methods:{addTopicSection(section,t,e){this.add((()=>this.$store.dispatch("topic/topicList/add",this.sectionParams(section,t))),e)},delTopicSection(section,t,e){this.del((()=>this.$store.dispatch("topic/topicList/delete",this.sectionParams(section,t))),e)},addDataset(t,e,o){var c=this;this.add(Object(n.a)((function*(){return yield function(t,e,o,n){return f.apply(this,arguments)}(c.$axios,c.datasetParams(t,e),c.$path.customDomain,c.$path.currentNoteHeadUrl)})),o)},delDataset(t,e,o){var c=this;this.del(Object(n.a)((function*(){return yield function(t,e,o,n,c){return y.apply(this,arguments)}(c.$axios,c.note.id,c.datasetParams(t,e),c.$path.customDomain,c.$path.currentNoteHeadUrl)})),o)},sectionParams:(section,t)=>({topicId:section.topicId,topicPageId:section.topicPageId,topicSectionId:section.id,contentType:"notes",contentId:t.id}),datasetParams:(t,e)=>({dataset_group_key:t.datasetGroupKey,dataset_key:t.key,content_id:e.id}),add:(t,e)=>Object(n.a)((function*(){try{yield t(),e()}catch(t){alert("更新が失敗しました。")}}))(),del:(t,e)=>Object(n.a)((function*(){try{yield t(),e()}catch(t){alert("削除が失敗しました。")}}))()}}),T=v,I=(o(4256),Object(r.a)(T,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"o-topicList"},[o("div",{staticClass:"o-topicList__body"},t._l(t.topics,(function(e){return o("div",{key:e.id,staticClass:"o-topicList__item"},[o("p",{staticClass:"o-topicList__title"},[o("nt-icon",{staticClass:"o-topicList__icon",attrs:{clickable:!1,type:"topic",size:"small"}}),t._v("\n        "+t._s(e.name)+"\n      ")],1),t._v(" "),t._l(e.sections,(function(section){return o("topic-list-item",{key:section.id,attrs:{item:section,note:t.note},on:{add:t.addTopicSection,del:t.delTopicSection}})})),t._v(" "),t._l(e.datasets,(function(e){return o("topic-list-item",{key:e.key,attrs:{item:e,note:t.note},on:{add:t.addDataset,del:t.delDataset}})}))],2)})),0)])}),[],!1,null,"89b4daa2",null));e.a=I.exports},4706:function(t,e,o){var content=o(5790);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,o(16).default)("21c9d184",content,!0,{sourceMap:!1})},5789:function(t,e,o){"use strict";o(4706)},5790:function(t,e,o){var n=o(15)((function(i){return i[1]}));n.push([t.i,".o-modalMagazineList__header[data-v-243bca70]{display:flex;align-items:baseline;justify-content:center}.o-modalMagazineList__body[data-v-243bca70]{max-height:400px;overflow:auto}",""]),n.locals={},t.exports=n},6787:function(t,e,o){"use strict";o.r(e);var n=o(0),c=(o(11),o(12),o(18),o(1)),l=o(54),d=o(586),r=o(620),m=o(73),_=o(43),h=o(82),f=o(155),y=o(138),v=o(4359),T=o(4364),I=o(4258),M=c.a.extend({components:{NtButton:_.a,MagazineList:v.a,TopicList:T.a,BasicModalContent:h.a,ModalHeading:f.a,NtLoadingDots:y.a,NtModal:m.a},mixins:[l.a],data:()=>({isLoading:!0,magazineCtx:null,magazines:[],listType:"",limitedTitle:"",selectedMagazineIds:[]}),computed:{note(){return this.$store.state.modal.magazineListModal.note},headerTitle(){return this.$store.state.modal.magazineListModal.headerTitle||"記事を追加"},location(){return this.$store.state.modal.magazineListModal.location},topics(){return this.$store.state.topic.topicList.mylist}},methods:{init(){var t=this;return Object(n.a)((function*(){yield t.load(),t.initList()}))()},reset(){this.isLoading=!0,this.magazineCtx=null,this.magazines=[],this.listType="",this.limitedTitle="",this.selectedMagazineIds=[]},load(){var t=this;return Object(n.a)((function*(){"TextNote"===t.note.type&&(yield t.$store.dispatch("topic/topicList/fetch",{noteId:t.note.id})),t.$store.dispatch(d.MAGAZINE_LIST_ACTION_TYPES.SET_NOTE,t.note),yield t.$store.dispatch(d.MAGAZINE_LIST_ACTION_TYPES.GET_MY_MAGAZINES),t.magazineCtx=t.$store.state.magazineList.myMagazineData,t.isLoading=!1}))()},initList(){if(0===this.magazineCtx.limitedNoteIncludedMagazineKeys.length)this.magazines=this.magazineCtx.magazines,this.listType="normal";else if(this.magazineCtx.limitedNoteIncludedMagazineKeys.length>0)if(0===this.note.price)this.currentUser.canMultipleLimitedNote?(this.magazines=this.$store.getters[d.MAGAZINE_LIST_GETTER_TYPES.GET_MY_MAGAZINES],this.listType="multipleLimitedPublish"):(this.magazines=this.$store.getters[d.MAGAZINE_LIST_GETTER_TYPES.SEARCH_MY_MAGAZINES]({key:this.magazineCtx.limitedNoteIncludedMagazineKeys}),this.listType="limitedPublish"),this.limitedTitle="有料マガジンで公開中";else if(this.note.price>0){var t=this.$store.getters[d.MAGAZINE_LIST_GETTER_TYPES.SEARCH_MY_MAGAZINES]({key:this.magazineCtx.limitedNoteIncludedMagazineKeys});t.length>0&&(this.magazines=[t[0]],this.listType="limitedSell",this.limitedTitle="限定販売中")}},onMagazineSelected(t){var e=this;return Object(n.a)((function*(){var{magazine:o,callback:n}=t,c={magazine:o,multipleLimited:!0===e.currentUser.canMultipleLimitedNote};try{var l;if(o.selected)l=yield e.$store.dispatch(d.MAGAZINE_LIST_ACTION_TYPES.REMOVE_FROM_MAGAZINE,c),e.selectedMagazineIds=[...e.selectedMagazineIds,o.id];else{l=yield e.$store.dispatch(d.MAGAZINE_LIST_ACTION_TYPES.ADD_TO_MAGAZINE,c);var m=e.selectedMagazineIds.indexOf(o.id);e.selectedMagazineIds=[...e.selectedMagazineIds.slice(0,m),...e.selectedMagazineIds.slice(m+1)]}if(l.noteStatus&&l.noteStatus!==e.note.status){var _=Object.assign(Object.assign({},e.note),{status:l.noteStatus});e.$store.commit(r.NOTE_LIST_MUTATION_TYPES.MODIFY_NOTE,_)}}catch(t){return void alert(Object(I.a)(t)?t.message:"エラーが発生しました。")}finally{n()}e.initList()}))()},createMagazine(t){var e=this;return Object(n.a)((function*(){try{yield e.$store.dispatch(d.MAGAZINE_LIST_ACTION_TYPES.CREATE_MAGAZINE,t)}catch(t){"magazine_count_exceeded"===t.code?alert("作成可能なマガジンは".concat(e.currentUser.maxMagazineAddCount,"個までです。")):alert("エラーが発生しました。")}}))()},close(){this.popModal(),this.selectedMagazineIds.length>0&&this.$store.commit(d.MAGAZINE_LIST_MUTATION_TYPES.SET_NOTE_ADDED_TO_MAGAZINE,{noteId:this.note.id,location:this.location})}}}),z=(o(5789),o(7)),component=Object(z.a)(M,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("nt-modal",{attrs:{name:"magazineList","disable-backdrop":!0},on:{"before-open":function(e){return t.init()},"before-close":function(e){return t.reset()}}},[o("basic-modal-content",{directives:[{name:"click-outside",rawName:"v-click-outside",value:t.close,expression:"close"}],staticClass:"o-modalMagazineList"},[o("modal-heading",{staticClass:"o-modalMagazineList__header",attrs:{slot:"header"},slot:"header"},[t._v("\n      "+t._s(t.headerTitle)+"\n    ")]),t._v(" "),o("div",{staticClass:"o-modalMagazineList__body",attrs:{slot:"body"},slot:"body"},[t.isLoading?[o("nt-loading-dots",{staticStyle:{height:"50px"},attrs:{slot:"body"},slot:"body"})]:[o("topic-list",{attrs:{topics:t.topics,note:t.note}}),t._v(" "),o("magazine-list",{attrs:{magazines:t.magazines,"list-type":t.listType,"limited-title":t.limitedTitle},on:{"magazine-selected":function(e){return t.onMagazineSelected(e)},"create-magazine":function(e){return t.createMagazine(e)}}})]],2),t._v(" "),o("nt-button",{attrs:{slot:"footer",size:"small",type:"basic"},on:{click:function(e){return t.close()}},slot:"footer"},[t._v("\n      閉じる\n    ")])],1)],1)}),[],!1,null,"243bca70",null);e.default=component.exports}}]);